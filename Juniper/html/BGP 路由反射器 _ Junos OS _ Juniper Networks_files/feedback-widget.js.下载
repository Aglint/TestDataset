let KEFeedbackWidget={};$(document).ready(function(){(KEFeedbackWidget={maxchar:800,feedbackFormElement:document.querySelector("#ke-feedback-form"),invalidemail:!1,sysid:1,additional:!1,issubmitted:!1,ismobile:!1,selectedRadio:null,iscollapsed:!0,thankstext:"Feedback Received. Thank You!",failuretext:"Feedback not received. Please try again.",feedbackyesno:{},submitinprogress:!1,options:[{text:"Yes",value:"Yes"},{text:"Yes...But",value:"Yes...But"},{text:"No",value:"No"}],userTypeList:[{name:"Current Customer"},{name:"Prospective Customer"},{name:"Partner"},{name:"Employee"}],userType:"",userEmail:"",userAskRatingList:[{name:"Not at all likely",aname:"Strongly Disagree"},{name:"Not likely",aname:"Disagree"},{name:"Less likely",aname:"Somewhat Disagree"},{name:"Neutral",aname:"Neutral"},{name:"Somewhat likely",aname:"Somewhat Agree"},{name:"Likely",aname:"Agree"},{name:"Very likely",aname:"Strongly Agree"}],userAskRating:{discuss_product:"",make_purchase:"",install_use_feature:"",acc_deploy:""},problems:["Info is missing/wrong","Needs example/video/graphic","Errors in grammar/spelling/links"],f:{wfsys_id:this.sysid,rating:"Excellent",hashvalue:location.hash,helped:"",problems:[],comment:"",addlComments:"",userEmail:"",contentid:"",transLang:""},init(){$("#ke-feedback-wrap").remove(),this.checkSysIdMeta(),this.checkmobile(),$(window).on("resize",this.resizer.bind(this)),this.render(),this.feedbackFormElement=document.querySelector("#ke-feedback-form"),"undefined"!=typeof PF_MULT_CAPTCHA&&PF_MULT_CAPTCHA.HCAPTCHA&&PF_MULT_CAPTCHA.HCAPTCHA.init(),this.setContentId(),this.setFeedbackBoxHeight(),this.setEmailId(),this.setTransLang()},render(){let e='\n        <div class="ke-feedback-wrap">\n          <div class="ke-feedback collapsed">\n           <form id="ke-feedback-form" name="ke-feedback-form">\n            <div class="fhead">\n              <span class="ke-feedback-icon"><img src="https://apps.juniper.net/assets/public/images/feedback.svg"></span>\n              <span class="ftext">Feedback</span>\n              <span class="minimize"><img src="https://apps.juniper.net/assets/public/images/horizontal_rule.svg"></span>\n            </div>\n            \n            <div class="fbody">';1!==this.sysid&&14!==this.sysid||(e+='\n        <div class="fb-askai-prompt-wrap">\n          <span class="fb-info-icon"><img src="https://apps.juniper.net/assets/public/images/info.svg"></span>\n          <div class="fb-askai-prompt-text">\n            <p>Have you tried using Ask AI? It\'s quick, easy, and designed to assist you with Juniper Networks\' products and solutions.</p>\n            <div class="fb-askai-prompt-buttons">\n              <button class="fb-askai-prompt-yes">Try Ask AI</button>\n            </div>\n          </div>\n        </div> '),e+=`\n        <div class="fform-body">\n            <div class="finit">\n              <div>\n                <strong>Did this content help you? <span>*</span></strong>\n              </div>\n              <div class="article-help">\n                ${this.options.map(e=>`\n                  <label class="flabel">\n                    <input type="radio" name="ftype" class="fradio" value="${e.value}" />\n                    ${e.text}\n                  </label>\n                `).join("")}\n              </div>\n            </div>\n            <div class="probs">\n              ${this.problems.map(e=>`\n                <label>\n                  <input type="checkbox" class="prblm-chkbx" value="${e}" />\n                  ${e}\n                </label>\n              `).join("")}\n            </div>\n            <div class="f-divider">\n              <div><strong>I am a:</strong></div>\n              <div class="usertype">\n                ${this.userTypeList.map(e=>`\n                  <label>\n                    <input type="radio" name="userType" value="${e.name}" />\n                    ${e.name}\n                  </label>\n                `).join("")}\n              </div>\n\n              <div class="cust-ask-rating-wrap curr-customer" style="display: none;">\n                  <div style="margin-top: 8px;"><strong>This content:</strong></div>\n                  <div class="ftrlegend">\n                      <span class="legnal">Strongly Disagree</span>\n                      <label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">1</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">2</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">3</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">4</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">5</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">6</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">7</span></label\n                      >\n                      <span class="legvl">Strongly Agree</span>\n                  </div>\n                  <table class="f-table table-bordered">\n                      <tr>\n                          <td class="ftwid">Helped me install or use the product</td>\n                          ${this.userAskRatingList.map((e,t)=>`\n                              <td>\n                              <label>\n                                  <input type="radio" class="ask-rating" name="install_use_feature" value="${t+1}" title="${e.aname}" />\n                              </label>\n                              </td>\n                          `).join("")}\n                      </tr>\n                      <tr>\n                          <td>Accelerated my deployment</td>\n                          ${this.userAskRatingList.map((e,t)=>`\n                              <td>\n                              <label>\n                                  <input type="radio" class="ask-rating" name="acc_deploy" value="${t+1}" title="${e.aname}" />\n                              </label>\n                              </td>\n                          `).join("")}\n                      </tr>\n                  </table>\n              </div>\n\n              <div class="cust-ask-rating-wrap prspctv-customer" style="display: none;">\n                  <div style="margin-top: 8px;"><strong>This content made me more likely to:</strong></div>\n                  <div class="ftrlegend">\n                      <span class="legnal">Not at all likely</span>\n                      <label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">1</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">2</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">3</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">4</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">5</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">6</span></label\n                      ><label class="ftlr"\n                          ><span class="radio"></span> <span class="ftnum">7</span></label\n                      >\n                      <span class="legvl">Very likely</span>\n                  </div>\n                  <table class="f-table table-bordered">\n                      <tr>\n                      <td class="ftwid">Discuss the product with a co-worker</td>\n                          ${this.userAskRatingList.map((e,t)=>`\n                              <td>\n                              <label>\n                                  <input type="radio" class="ask-rating" name="discuss_product" value="${t+1}" title="${e.name}" />\n                              </label>\n                              </td>\n                          `).join("")}\n                      </tr>\n                      <tr>\n                      <td>Make a purchase inquiry</td>\n                          ${this.userAskRatingList.map((e,t)=>`\n                              <td>\n                              <label>\n                                  <input type="radio" class="ask-rating" name="make_purchase" value="${t+1}" title="${e.name}" />\n                              </label>\n                              </td>\n                          `).join("")}\n                      </tr>\n                  </table>\n              </div>\n\n            </div>\n            <div class="feedback-widget">\n              <div id="feedback-more">\n                <p class="mrg0"><strong>Tell us more (optional)</strong></p>\n                <textarea id="comment" maxlength="${this.maxchar}"></textarea>\n                <div id="comment-max" class="small-rt" style="display: none;">\n                  Maximum of 800 characters allowed.\n                </div>\n                <p class="mrg0"><strong>What are you trying to do? (optional)</strong></p>\n                <textarea id="addlComments" maxlength="${this.maxchar}"></textarea>\n                <div id="addlComments-max" class="small-rt" style="display: none;">\n                  Maximum of 800 characters allowed.\n                </div>\n                <div style="font-size: 12px">\n                  Please provide your email address so we can reach out to you regarding your feedback.\n                </div>\n                <input id="useremail" type="text" placeholder="Email (optional)" />\n                <div id="invalid-email" class="fb-invalid-email" style="display: none;">\n                  Enter a valid email address\n                </div>\n                <div class="fbtn-group">\n                  <div id="ke-fb-hcaptcha" style="display:none;"></div>\n                  <div class="fb-user-actions">\n                    <input id="submit-btn" type="button" class="button button-darkgreen button-disable" value="Submit"/>\n                    <input id="cancel-btn" type="button" class="button button-white" value="Cancel" />\n                  </div>\n                  <div class="fb-submit-in-progress">Processing your feedback. Please wait a moment.</div>\n                </div>\n                <div id="recaptcha"></div>\n                <p class="recap-privacy">\n                  This site is protected by hCaptcha and its\n                  <a href="https://hcaptcha.com/privacy" target="_blank">Privacy Policy</a> and\n                  <a href="https://hcaptcha.com/terms" target="_blank">Terms of Service</a> apply.\n                </p>\n              </div>\n            </div>\n            </div>\n            <p class="ke-fb-thanks">${this.thankstext}</p>\n            <p class="ke-failed-fb-thanks">${this.failuretext}</p>\n            <div class="fload" style="display: none;"></div>\n          </div>\n      </form>\n      </div>\n    </div>\n    `,$("body").append(e),setTimeout(()=>{this.bindEvents()},1e3)},bindEvents(){this.feedbackFormElement.querySelector("#comment").addEventListener("input",()=>this.checkMaxLength("comment")),this.feedbackFormElement.querySelector("#addlComments").addEventListener("input",()=>this.checkMaxLength("addlComments")),this.feedbackFormElement.querySelector("#useremail").addEventListener("keyup",this.validateFbEmail.bind(this)),this.feedbackFormElement.querySelector("#submit-btn").addEventListener("click",this.validateFbCaptcha.bind(this)),this.feedbackFormElement.querySelector("#cancel-btn").addEventListener("click",this.cancelFeedback.bind(this)),this.feedbackFormElement.querySelector(".fhead").addEventListener("click",this.expandfeedback.bind(this)),this.feedbackFormElement.querySelectorAll('input[name="ftype"]').forEach(e=>{e.addEventListener("change",this.feedback_type.bind(this))}),this.feedbackFormElement.querySelectorAll('input[name="userType"]').forEach(e=>{e.addEventListener("change",this.changeUserType.bind(this))}),this.feedbackFormElement.querySelectorAll("input, textarea").forEach(e=>{e.addEventListener("input",this.toggleFbSubmitButton.bind(this))}),this.feedbackFormElement.querySelectorAll('input[type="checkbox"]').forEach(e=>{e.addEventListener("change",this.fbProblemsUpdated.bind(this))}),this.feedbackFormElement.querySelectorAll("input.ask-rating").forEach(e=>{e.addEventListener("change",this.captureAskRating.bind(this))}),$(this.feedbackFormElement).find(".fb-askai-prompt-wrap .fb-askai-prompt-yes").on("click",this.openAskAISug.bind(this)),$(this.feedbackFormElement).find(".fb-askai-prompt-wrap .fb-askai-prompt-no").on("click",this.closeAskAISug.bind(this)),$(this.feedbackFormElement).find(".recap-privacy a").on("click",function(e){e.stopPropagation()})},getSysId(){switch(window.location.hostname){case"www.juniper.net":case"techlibrary-dev.juniper.net":case"techlibrary-stage.juniper.net":case"uat-aem.juniper.net":return 1;case"apps.juniper.net":case"apps-dev.juniper.net":case"apps-stage.juniper.net":return 5;default:return 999}},fbProblemsUpdated(){this.f.problems=$(this.feedbackFormElement).find('input.prblm-chkbx[type="checkbox"]:checked').map(function(){return this.value}).get(),this.toggleFbSubmitButton()},checkMaxLength(e){const t=$(`#${e}`).val();t.length>=this.maxchar?$(`#${e}-max`).show():$(`#${e}-max`).hide(),this.f[e]=t},validateFbEmail(e){const t=this.feedbackFormElement.querySelector("#useremail").value.trim();if(this.f.userEmail=t,""!=t){const e=/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,4})+$/;this.invalidemail=t&&!e.test(t)}else this.invalidemail=!1;$(this.feedbackFormElement).find("#invalid-email").toggle(this.invalidemail),this.toggleFbSubmitButton()},validateFbCaptcha(){if(!this.disableSubmit()&&window.hcaptchaInstance){if(null==keFeedbackWidget){console.error("Error: hCaptcha widget with ID 'keFeedbackWidget' on element with ID 'ke-fb-hcaptcha' not found. Reinitializing...");const e="d648595f-1049-4201-ab06-f5e68b4268f4";return void(keFeedbackWidget=window.hcaptchaInstance.render("ke-fb-hcaptcha",{sitekey:e,theme:"light",size:"invisible",badge:"inline",callback:()=>{console.log("hCaptcha reinitialized successfully."),this.validateFbCaptcha()}}))}$(this.feedbackFormElement).find(".fform-body").addClass("submit-in-progress"),$(this.feedbackFormElement).find(".fb-user-actions").hide(),$(this.feedbackFormElement).find(".fb-submit-in-progress").css("visibility","visible"),window.hcaptchaInstance.execute(keFeedbackWidget,{async:!0}).then(({response:e,key:t})=>{$(this.feedbackFormElement).find(".fb-submit-in-progress").css("visibility","hidden"),KEFeedbackWidget.submitFeedback(e)}).catch(e=>{console.error("Captcha Error:",e),$(this.feedbackFormElement).find(".fb-user-actions").show(),$(this.feedbackFormElement).find(".fform-body").removeClass("submit-in-progress")})}},disableSubmit(){return!window.hcaptchaInstance||!this.allowEmpty&&(!this.feedbackyesno.helped||(!("Yes"===this.feedbackyesno.helped||this.f.problems.length||this.f.comment.trim()||this.f.addlComments.trim())||this.invalidemail))},toggleFbSubmitButton(){const e=this.disableSubmit();$(this.feedbackFormElement).find("#submit-btn").prop("disabled",e).toggleClass("button-disable",e)},cancelFeedback(){this.f.comment="",this.f.addlComments="",this.f.userEmail="",this.resetfeedback(),this.minimize()},setEmailId(){const e=sessionStorage.getItem("tluser"),t=window.user&&""!=window.user.email?window.user.email:null;if(e){const[t,s]=e.split("|");this.userEmail=t}else t&&(this.userEmail=t);this.userEmail&&(this.f.userEmail=this.userEmail,$(this.feedbackFormElement).find("#useremail").val(this.userEmail))},setTransLang(){const e=sessionStorage.getItem("tlLang")||"";this.f.transLang=""!=e?e:null},setContentId(){let e="";window.__product&&window.__product.name?e=window.__product.name:window.__solution&&window.__solution.solnId?e=window.__solution.solnId:document.querySelector('meta[name="topicid"]')&&(e=document.querySelector('meta[name="topicid"]').getAttribute("content")),this.f.contentid=e},getAdditionalParams(){let e=document.title.split("|")[0].trim(),t=document.querySelector(".mtd .p-title"),s=t?t.textContent.trim():null,a="dita-topic"===this.getMetaValue("jdoc-content-type")?e:null,i=document.querySelector(".breadcrumb-pname"),n=i?i.textContent.trim():window.__product?window.__product.name.trim():null;return{...e&&{pageTitle:e},...s&&{guideTitle:s},...a&&{topicTitle:a},...n&&{productName:n}}},getMetaValue(e){const t=document.querySelector(`meta[name="${e}"]`);return t?t.getAttribute("content"):null},submitFeedback(e){this.submitinprogress=!0,$(this.feedbackFormElement).find(".fload").show(),$(this.feedbackFormElement).find(".fbody").css("overflow-y","visible");const t={wfsys_id:this.f.wfsys_id,rating:this.f.rating,hashValue:location.hash,helped:this.f.helped,comment:this.f.comment,addlComments:this.f.addlComments,problems:this.f.problems.join("~"),useremail:this.f.userEmail?this.f.userEmail.trim():null,fromUrl:location.href,transLang:this.f.transLang,userType:this.userType,userAskRating:this.getUserAskRating(),verifyId:e,...this.getAdditionalParams()};this.f.contentid&&(t.contentId=this.f.contentid);const s=this.getMetaValue("branchId");s&&(t.branchId=s);const a=this.getMetaValue("jdoc-content-type");a&&(t.jDocId=a),$.post("https://apps.juniper.net/webform/submitFeedbackForm.do",t).done(e=>{"SUCCESS"===(e=null!=e?e.trim().toUpperCase():"")?this.showThanks():this.showTryagain()}).fail(e=>{console.error("ERROR,",e),this.showTryagain()}).always(()=>{$(this.feedbackFormElement).find(".fb-user-actions").show(),$(this.feedbackFormElement).find(".fform-body").removeClass("submit-in-progress")})},showThanks(){this.issubmitted=!0,$(this.feedbackFormElement).find(".fbody").removeAttr("style"),$(this.feedbackFormElement).find(".fform-body, .fload, .fb-askai-prompt-wrap").hide(),$(".ke-feedback").removeClass("fb-more"),$(this.feedbackFormElement).find(".ke-fb-thanks").show(),this.submitinprogress=!1,setTimeout(()=>{this.cancelFeedback()},2e3)},showTryagain(){this.issubmitted=!0,$(this.feedbackFormElement).find(".fbody").removeAttr("style"),$(this.feedbackFormElement).find(".fform-body, .fload, .fb-askai-prompt-wrap").hide(),$(".ke-feedback").removeClass("fb-more"),$(this.feedbackFormElement).find(".ke-failed-fb-thanks").show(),this.submitinprogress=!1,setTimeout(()=>{this.cancelFeedback()},2e3)},isProd:()=>"apps.juniper.net"===location.hostname||"www.juniper.net"===location.hostname,checkSysIdMeta(){const e=this.getMetaValue("sysid");this.sysid=this.f.wfsys_id=null!=e?+e:this.getSysId()},captureAskRating(e){const t=e.target.value,s=e.target.getAttribute("name");this.userAskRating[s]=t},getUserAskRating(){let e=[];for(const t in this.userAskRating)if(Object.hasOwnProperty.call(this.userAskRating,t)){const s=this.userAskRating[t];""!==s&&e.push(t+":"+s)}return e.join(";")},handleAskRating(){$(this.feedbackFormElement).find(".cust-ask-rating-wrap ").hide();for(const e in this.userAskRating)Object.hasOwnProperty.call(this.userAskRating,e)&&(this.userAskRating[e]="",$(this.feedbackFormElement).find('.ask-rating[name="'+e+'"]').prop("checked",!1));"No"!==this.f.helped?"Current Customer"===this.userType?$(this.feedbackFormElement).find(".curr-customer").show():"Prospective Customer"===this.userType?$(this.feedbackFormElement).find(".prspctv-customer").show():$(this.feedbackFormElement).find(".cust-ask-rating-wrap ").hide():$(this.feedbackFormElement).find(".cust-ask-rating-wrap ").hide()},changeUserType(e){const t=e.target.value;this.userType=t,this.handleAskRating(),this.setFeedbackBoxHeight()},resizer(){this.checkmobile(),this.setFeedbackBoxHeight()},setFeedbackBoxHeight(){const e=$(this.feedbackFormElement).find(".fbody")[0];e.style="";let t=e.getBoundingClientRect();(Math.round(t.top)<35||window.innerHeight<360&&!this.iscollapsed)&&(e.style.height=parseInt(t.height+t.top-34)+"px",e.style.overflowY="auto")},feedback_type(e){const t=e.target.value;let s={};s.rating="Yes"===t?"Excellent":"Average",s.helped=t,this.f.helped=t,this.feedback_init(s),this.handleAskRating()},resetfeedback(){this.feedbackyesno={},this.f.problems=[],this.iscollapsed=!0,this.additional=!1,this.selectedRadio=null,this.userType="",this.issubmitted=!1,this.userAskRating={discuss_product:"",make_purchase:"",install_use_feature:"",acc_deploy:""},this.f.comment="",this.f.addlComments="",this.f.userEmail=this.userEmail?this.userEmail:"",$(this.feedbackFormElement).find('input[name="ftype"], input[name="userType"], input[type="checkbox"], input.ask-rating').prop("checked",!1),$(this.feedbackFormElement).find("#feedback-more  input[type='text'], #feedback-more  textarea").val(""),$(this.feedbackFormElement).find(".cust-ask-rating-wrap, .fb-invalid-email, .ke-fb-thanks, .ke-failed-fb-thanks").hide(),$(this.feedbackFormElement).find(".fform-body").show(),$(this.feedbackFormElement).find(".fb-askai-prompt-wrap").show(),this.userEmail?(this.f.userEmail=this.userEmail,$(this.feedbackFormElement).find("#useremail").val(this.userEmail)):(this.f.userEmail="",$(this.feedbackFormElement).find("#useremail").val("")),this.toggleFbSubmitButton()},checkmobile(){this.ismobile=window.innerWidth<960,$(".ke-feedback").toggleClass("mobile",this.ismobile)},expandfeedback(e){e&&(e.stopPropagation,e.preventDefault),this.iscollapsed=!this.iscollapsed,this.additional=!0,$(".ke-feedback").toggleClass("collapsed",this.iscollapsed),this.iscollapsed?($(".ke-feedback").removeClass("fb-more"),$(".ke-feedback-wrap").removeClass("blur")):($(".ke-feedback").addClass("fb-more"),$(".ke-feedback-wrap").addClass("blur")),this.setFeedbackBoxHeight(),this.setEmailId()},minimize(){this.iscollapsed=!0,this.additional=!0,$(".ke-feedback").toggleClass("collapsed",this.iscollapsed).css("height","auto"),$(".ke-feedback-wrap").removeClass("blur")},feedback_init(e){this.additional=!0,this.feedbackyesno=e,$(".ke-feedback").addClass("fb-more"),this.toggleFbSubmitButton()},openAskAISug(e){e&&(e.stopPropagation(),e.preventDefault()),this.cancelFeedback();const t=document.querySelector("pf-aibot-wrap .ai-modal-img-wrap img");t&&t.click()},closeAskAISug(e){e&&(e.stopPropagation(),e.preventDefault()),$(".fb-askai-prompt-wrap").hide()}}).init()});